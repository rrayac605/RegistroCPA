<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition 
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

	<link href="#{facesContext.externalContext.requestContextPath}/css/dropzone.css" rel="stylesheet" type="text/css" />
	<link href="#{facesContext.externalContext.requestContextPath}/css/custom.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/dropzone.js"  />
	<script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/loadFile.js" />
	

	 <form  action="http://XXXXXx.XXXXXX.com/" method="post" enctype="multipart/form-data" style="width:100%;height:100% " >																	
	</form>					   
	 <p:accordionPanel value="#{cargaArchivosPage.listaParentLayout}" var="parentLayout" multiple="true" activeIndex="0,1,2,3,4,5">
					        <p:tab title="#{parentLayout.name}">
					            <p:panel>         		
									   <p:carousel  value="#{parentLayout.listaLayout}" var="layout" itemStyle="text-align:center" 
									   style="width:100%" numVisible="4" > 					   
									        <p:panel columns="1" style="width:250px;height:300px;margin:10px 0px" layout="grid" >									            
									 			<p:outputLabel value="#{layout.name}" /> 									            									 
												<form  action="http://intellegomx.s3.amazonaws.com/" id="drop#{layout.idLayout}" method="post" class="dropzone dz-clickable" enctype="multipart/form-data" style="width:100%;height:100% " >
														<div class="dz-message" style="width:95%">
														    #{msg['message.dictamen.patronal.carga.layout.atarrastar']}<br/>
														    #{msg['message.dictamen.patronal.carga.layout.documento']}<br/>
														    <p:graphicImage id="cuadernilloGI" style="width: 30px; height: 30px; margin: 0 5px 0 2px;" value="/images/upload.png"  />
														    <span class="note">#{msg['message.dictamen.patronal.carga.layout.seleccionar']}</span>
														</div>
														  <input type="hidden" name="key" value="#{layout.policy.key}${filename}"/>
													      <input type="hidden" name="AWSAccessKeyId" value="#{layout.policy.awsAccessKeyId}"/>   
													      <input type="hidden" name="acl" value="#{layout.policy.acl}"/> 
													      <input type="hidden" name="x-amz-meta-uuid" value="#{layout.policy.xamzMetaUuid}" />
													      <input type="hidden" name="x-amz-meta-tag" value="#{layout.policy.xamzMetaTag}" />
													      <input type="hidden" name="X-Amz-Credential" value="#{layout.policy.xamzCredential}" />
													      <input type="hidden" name="X-Amz-Algorithm" value="#{layout.policy.xamzAlgorithm}" />
													      <input type="hidden" name="X-Amz-Date" value="#{layout.policy.xamzDate}" />      
													      <input type="hidden" name="success_action_status" value="#{layout.policy.successActionStatus}"/>
													      <input type="hidden" name="policy" value="#{layout.policy.policy}"/>
													      <input type="hidden" name="signature" value="#{layout.policy.signature}"/> 
													      <input type="hidden" name="Content-Type" value="#{layout.policy.contentType}"/>													      
 												</form>	 												
												<h:form>	
													<p:commandButton id="hiddenAction" process="@this" action="#{cargaArchivosBean.registrarEstatusCarga(layout)}" type="submit" immediate="true" style="display:none"/>																		      													       
													<h:outputScript>
													Dropzone.autoDiscover = false;
													$(function() {
													  var myDropzone = new Dropzone("#drop#{layout.idLayout}",{
													  	accept: function(file, done){validateFile(file, done);},
													  	maxFilesize: 500,
													  	addRemoveLinks: true,
													  	dictRemoveFile:"Eliminar archivo",
													  	maxFiles:1,
													  	dictMaxFilesExceeded:"Sólo se permite un archivo por Aseveración."});
													  myDropzone.on("success", function(file,responseText) {
													  	document.getElementById("#{p:component('hiddenAction')}").click();
													  });
													  function validateFile(file, done){
													  	var allowed_extensions = new Array("txt");
													  	var file_extension = file.name.split('.').pop();
													  	for(i = 0;  allowed_extensions.length > i ; i++){
													  		if(allowed_extensions[i]==file_extension){
													  			done();
													  			return true;
													  			}
													  		}
													  	done("Tipo de archivo no permitido.");
													  	return false;											  	
													  }
													});
													</h:outputScript>
												</h:form>
											</p:panel>
									    </p:carousel>					 	
					 	        </p:panel>
					        </p:tab>
					    </p:accordionPanel>					    
</ui:composition>